# カメラマネージャ (CameraManager) 超入門

> **ひと言で** : 画面を“いい感じ”に動かす係。プレイヤーや UI のロジックを書いたファイルとは切り離し、カメラの動きだけをまとめて面倒みるクラスです。

---

## 1. そもそもカメラって？

ゲームの世界（タイルで作られた迷路）は実際には **もっと広い** けれど、プレイヤーが見るのはその一部だけ。この覗き窓を **カメラ (Camera)★** と呼びます。

> ★Phaser では `this.cameras.main` というオブジェクトがそれ。

---

## 2. CameraManager とは？

| 役割            | なにをする？                                                    | なぜ分ける？                   |
| ------------- | --------------------------------------------------------- | ------------------------ |
| **① 専用の司令塔**  | `pan` (位置移動)、`zoom` (拡大縮小)、`flash` (画面フラッシュ) の命令を 1 か所に集約 | GameScene ファイルがゴチャゴチャしない |
| **② タイミング管理** | *新しい迷路チャンクが生えた瞬間* にカメラをそっと中央へ動かす 400 ms アニメ、など            | 「いつ動くか」をコードで追いやすい        |
| **③ UI と分離**  | UI/HUD は別 Scene で固定表示。カメラがどんなに動いても UI はピクリとも動かない          | スコア表示がカメラ移動でブレない！        |

イメージ図

```
┌ UI Scene ┐  ← 固定 (SCORE など)
│────────│
│ Game Cam ├─ pan / zoom by CameraManager
│────────│
```

---

## 3. 動くタイミングは 3 つだけ

1. **ゲーム開始** : 最初のチャンク中央へ瞬時に合わせる (0 ms)。
2. **新チャンク生成** : `panToChunk()` で 400 ms かけてスムース移動＋`zoomBump()` で揺れ演出。
3. **ゲームオーバー** : `flashWhite()` → 画面暗転。

これ以外はカメラを動かさないので、管理が超シンプル。

---

## 4. ざっくりコード

```ts
class CameraManager {
  constructor(private cam: Phaser.Cameras.Scene2D.Camera){}

  // 1. チャンクの中心へ移動
  panToChunk(chunk: MazeChunk, dur=400){
    const cx = chunk.x + chunk.size*16; // 32pxタイル → 半分
    const cy = chunk.y + chunk.size*16;
    this.cam.pan(cx, cy, dur, 'Sine.easeInOut');
  }

  // 2. 軽い揺れ (ズームバンプ)
  zoomBump(){
    this.cam.zoomTo(0.95,150)
      .once('camerazoomcomplete', ()=> this.cam.zoomTo(1,200));
  }

  // 3. 白フラッシュ
  flashWhite(){ this.cam.flash(120,255,255,255); }
}
```

- **GameScene** 内ではインスタンスを作り、イベントで呼ぶだけ。

```ts
generator.on('chunk-created', ch => cameraMgr.panToChunk(ch));
```

---

## 5. UI / HUD との関係

| 項目                | やること               | やらないこと        |
| ----------------- | ------------------ | ------------- |
| **GameScene**     | 迷路・主人公・敵など「世界を描く」  | UI 描画         |
| **CameraManager** | GameScene のカメラを動かす | UI には触れない     |
| **UIScene**       | スコア・残タイムを画面固定で描く   | カメラ操作・ゲームロジック |

- UI は仮想 480×270 座標で **常に同じ位置**。
- カメラが動いても UI はレイヤーが違うのでピクリとも動かない。

---

## 6. Q&A

**Q. カメラが UI を巻き込んで動いてしまう！**\
→ GameScene と UIScene を分けていますか？ 1 つの Scene に全部置くと一緒に動いてしまいます。

**Q. カメラ移動がガタつく…**\
→ `pan` が終わる前に次の `pan` を呼んでいませんか？ `isPanning` フラグやイベントで制御しましょう。

---

## 7. まとめ

- **CameraManager = カメラ操作のまとめ役**。
- UI/HUD は別レイヤーなので影響なし。
- 新チャンク中心へパンする 400 ms の演出だけ覚えれば OK。

これでカメラの仕組みが迷子にならず、あとから演出を足すときもここだけ触れば安全です！

---

© 2025 Dainei Makino. 本資料はプロジェクトメンバー・教育目的での転載を許可します。

